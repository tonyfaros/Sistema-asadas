<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>sistema-asadas documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">sistema-asadas documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search">
</div>
            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>genericInfraestructure</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/components/map-google/map-google.component.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#$key">$key</a>
                                </li>
                                <li>
                                        <a href="#asada">asada</a>
                                </li>
                                <li>
                                        <a href="#iconConfig">iconConfig</a>
                                </li>
                                <li>
                                        <a href="#lat">lat</a>
                                </li>
                                <li>
                                        <a href="#long">long</a>
                                </li>
                                <li>
                                        <a href="#name">name</a>
                                </li>
                                <li>
                                        <a href="#phonenumber">phonenumber</a>
                                </li>
                                <li>
                                        <a href="#province">province</a>
                                </li>
                                <li>
                                        <a href="#risk">risk</a>
                                </li>
                                <li>
                                        <a href="#riskLevel">riskLevel</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#type">type</a>
                                </li>
                                <li>
                                        <a href="#visible">visible</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="$key"></a>
                                        <span class="name"><b>$key</b><a href="#$key"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>$key:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="asada"></a>
                                        <span class="name"><b>asada</b><a href="#asada"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>asada:     <code>literal type</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>literal type</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="iconConfig"></a>
                                        <span class="name"><b>iconConfig</b><a href="#iconConfig"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>iconConfig:     <code>literal type</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>literal type</code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lat"></a>
                                        <span class="name"><b>lat</b><a href="#lat"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lat:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="long"></a>
                                        <span class="name"><b>long</b><a href="#long"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>long:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name"><b>name</b><a href="#name"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="phonenumber"></a>
                                        <span class="name"><b>phonenumber</b><a href="#phonenumber"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>phonenumber:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="province"></a>
                                        <span class="name"><b>province</b><a href="#province"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>province:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="risk"></a>
                                        <span class="name"><b>risk</b><a href="#risk"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>risk:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="riskLevel"></a>
                                        <span class="name"><b>riskLevel</b><a href="#riskLevel"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>riskLevel:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="type"></a>
                                        <span class="name"><b>type</b><a href="#type"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>type:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="visible"></a>
                                        <span class="name"><b>visible</b><a href="#visible"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>visible:     <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, ViewChild, ViewEncapsulation, group } from &#x27;@angular/core&#x27;;
import { AgmMap } from &#x27;@agm/core&#x27;;
import { BrowserModule } from &#x27;@angular/platform-browser&#x27;;
import { NgModule, ApplicationRef } from &#x27;@angular/core&#x27;;
import { AgmCoreModule } from &#x27;angular2-google-maps/core&#x27;;

import { MapGoogleService } from &#x27;./map-google.service&#x27;;
import { Infrastructure } from &#x27;../../common/model/Infrastructure&#x27;;
import { Asada } from &#x27;../../common/model/Asada&#x27;;
import { SebmGoogleMap } from &#x27;angular2-google-maps/core&#x27;;
import { AngularFire, FirebaseAuthState } from &#x27;angularfire2/index&#x27;;
import { UserService } from &quot;app/common/service/user.service&quot;;
import { ActivatedRoute, Params, Router } from &#x27;@angular/router&#x27;;

import { Subscription } from &quot;rxjs/Subscription&quot;;
import { filterConfig, filterParam,LocationsService, locaciones, location, provincia, canton, distrito } from &#x27;../filter/filter.component&#x27;;

import * as ol from &#x27;openlayers&#x27;;


@Component({
    selector: &#x27;app-map-google&#x27;,
    templateUrl: &#x27;./map-google.component.html&#x27;,
    styleUrls: [&#x27;./map-google.component.scss&#x27;],
    providers: [MapGoogleService, UserService,LocationsService]//,
    // encapsulation: ViewEncapsulation.None,
})

export class MapGoogleComponent implements OnInit {


    //---------------------Atributos Generales
    private allList: Infrastructure[];
    private AsadasList: Asada[];
    private AsadasListTemp: Asada[];

    public AsadaId: string;
    public AsadaUser: string;
    public UserRol: string;
    public loadgraphic: boolean;

    // public cantidadTanques &#x3D; 0;
    // public cantidadCaptaciones &#x3D; 0;
    // public cantidadCloracion &#x3D; 0;
    public lastOpen: any;

    //---------------------Atributos Autenticacion
    private user: FirebaseAuthState;
    public isLoggedIn: boolean;

    //---------------------Atributos generales Mapas
    //START POSITION
    public centerLat: number &#x3D; 9.852275;
    public centerLng: number &#x3D; -83.9004535;
    //CURRENT POSITION
    public currentLat: number &#x3D; this.centerLat;
    public currentLng: number &#x3D; this.centerLng;
    //ZOOM LEVEL
    public mapZoom: number &#x3D; 9;
    public mapMinZoom: number &#x3D; 7;
    public currentZoom: number &#x3D; this.mapZoom;

    //MAP MARKER SIZE
    private markerSize &#x3D; 28;

    //MARKERS
    asadasmarkers: asadastructure[];
    infraestructuremarkers: genericInfraestructure[];

    //MAPS ACTIVATIONS TOGGLE
    public googleMapActivation: boolean &#x3D; false;
    public snitMapActivation: boolean &#x3D; false;
    public dataLoaded: boolean &#x3D; false;

    //---------------------Atributos Mapas Snit
    private snitMap: ol.Map;
    private markerSource: ol.source.Vector;

    private capaDistrital: snitMapLayer;
    private capaCantonal: snitMapLayer;
    private capaProvincial: snitMapLayer;
    private capaDetalle: snitMapLayer;
    private capaUrbana: snitMapLayer;
    private capaOSM: snitMapLayer;

    public layersGroupList: snitMapLayerGroup[];

    private vectorIcon: ol.layer.Vector;
    private popupOverlay: ol.Overlay;
    private snitMapView: ol.View;

    public snitSelectedElement: any;

    private layerData: any &#x3D; {
        &#x27;capaDistrital&#x27;: {
            &#x27;url&#x27;: &#x27;http://geos.snitcr.go.cr/be/IGN_5/wms?&#x27;,
            params: {
                &#x27;LAYERS&#x27;: &#x27;limitedistrital_5k&#x27;, &#x27;VERSION&#x27;: &#x27;1.1.1&#x27;,
                &#x27;TILED&#x27;: true,
                &#x27;FORMAT&#x27;: &#x27;image/png&#x27;,
                &#x27;TRANSPARENT&#x27;: true,
            }
        },
        &#x27;capaCantonal&#x27;: {
            &#x27;url&#x27;: &#x27;http://geos.snitcr.go.cr/be/IGN_5/wms?&#x27;,
            params: {
                &#x27;LAYERS&#x27;: [&#x27;limitecantonal_5k&#x27;], &#x27;VERSION&#x27;: &#x27;1.1.1&#x27;,
                &#x27;TILED&#x27;: true,
                &#x27;FORMAT&#x27;: &#x27;image/png&#x27;,
                &#x27;TRANSPARENT&#x27;: true,
            }
        },
        &#x27;capaProvincial&#x27;: {
            &#x27;url&#x27;: &#x27;http://geos.snitcr.go.cr/be/IGN_5/wms?&#x27;,
            params: {
                &#x27;LAYERS&#x27;: &#x27;limiteprovincial_5k&#x27;, &#x27;VERSION&#x27;: &#x27;1.1.1&#x27;,
                &#x27;TILED&#x27;: true,
                &#x27;FORMAT&#x27;: &#x27;image/png&#x27;,
                &#x27;TRANSPARENT&#x27;: true,
            }
        },
        &#x27;capaDetalle&#x27;: {
            url: &#x27;http://geos0.snitcr.go.cr/cgi-bin/web?map&#x3D;hojas50.map&amp;SERVICE&#x3D;WMS&amp;version&#x3D;1.1.1&amp;request&#x3D;GetCapabilities&#x27;,
            params: {
                &#x27;LAYERS&#x27;: &#x27;hojas_50&#x27;, &#x27;TILED&#x27;: true,
            },
            serverType: &#x27;geoserver&#x27;,
            transition: 0
        },
        &#x27;capaUrbana&#x27;: {
            url: &#x27;http://geos.snitcr.go.cr/be/IGN_5/wms?&#x27;,
            params: { &#x27;LAYERS&#x27;: &#x27;urbano_5000&#x27;, &#x27;TILED&#x27;: true },
            serverType: &#x27;geoserver&#x27;,
            transition: 0
        }
    };

    //---------------------Atributos Mapas google
    @ViewChild(&#x27;googleMap&#x27;) googleMap: AgmMap;
    private isGoogleMapReady: boolean &#x3D; false;

    //----------------------Atributos Filtrado de elementos
    public filterConfiguration: filterConfig;

    constructor(private mapService: MapGoogleService, private af: AngularFire, private userService: UserService, private router: Router, private route: ActivatedRoute,private locationService:LocationsService) {
        this.allList &#x3D; [];
        this.AsadasList &#x3D; [];
        this.AsadasListTemp &#x3D; [];
        this.infraestructuremarkers &#x3D; [];
        this.asadasmarkers &#x3D; [];
    }

    ngOnInit() {
        this.googleMapActivation &#x3D; true;
        this.af.auth.subscribe(user &#x3D;&gt; {
            if (user) {
                this.user &#x3D; user;
                this.isLoggedIn &#x3D; true;
                var userDetails &#x3D; this.userService.getRolAccess(this.user.uid);
                userDetails.subscribe(
                    results &#x3D;&gt; {
                        this.AsadaUser &#x3D; results.asada;
                        this.UserRol &#x3D; results.rol;
                        this.getResultAsadasTemp();
                    }
                );
            }
            else {
                this.isLoggedIn &#x3D; false;
                this.getResultAsadasTemp();
            }
        });
        this.googleOnMapReady();
        this.generateSnitMap();
        this.updateLocalStorageInfo();
        //--------------------------------temporal
        //this.activateSnitMap();
        //-----------------------------------
    }
    updateLocalStorageInfo() {
        var initialMap &#x3D; localStorage[&quot;initialMap&quot;];
        switch (initialMap) {
            case &#x27;snitMap&#x27;: {
                this.activateSnitMap(); break
            }
            case &#x27;googleMap&#x27;: {
                this.activateGoogleMap(); break
            }
            default:{
                localStorage[&quot;initialMap&quot;] &#x3D; &#x27;googleMap&#x27;;break;
            }
        }
    }

    googleOnMapReady() {
        if (this.googleMap) {
            this.googleMap.mapReady.subscribe(map &#x3D;&gt; {
                this.isGoogleMapReady &#x3D; true;
            });
        }
    } 

    activateGoogleMap() {
        localStorage[&quot;initialMap&quot;]&#x3D;&#x27;googleMap&#x27;;
        this.googleMapActivation &#x3D; true;
        this.snitMapActivation &#x3D; !this.googleMapActivation;
    }

    activateSnitMap() {
        if (this.googleMapActivation &amp;&amp; this.googleMap &amp;&amp; this.isGoogleMapReady) {
            this.currentLat &#x3D; this.googleMap.latitude;
            this.currentLng &#x3D; this.googleMap.longitude;
            this.currentZoom &#x3D; this.googleMap.zoom;
            this.updateSnitMapCenter();
        }
        localStorage[&quot;initialMap&quot;]&#x3D;&#x27;snitMap&#x27;;
        this.snitMapActivation &#x3D; true;
        this.googleMapActivation &#x3D; !this.snitMapActivation;
    }

    initSnitMapAssets() {
        var scope &#x3D; this;
        this.markerSource &#x3D; new ol.source.Vector();

        function markerStyle(feature) {
            var url &#x3D; feature.get(&#x27;url&#x27;);
            var style &#x3D; new ol.style.Style({
                image: new ol.style.Icon({
                    anchor: [0.5, 0.5],
                    scale: 0.33,
                    src: url,
                })
            });
            return style;
        }

        this.vectorIcon &#x3D; new ol.layer.Vector({
            source: this.markerSource,
            style: markerStyle
        });

        var container: any &#x3D; document.getElementById(&#x27;popup&#x27;);
        var closer &#x3D; document.getElementById(&#x27;popup-closer&#x27;);
        closer.onclick &#x3D; function () {
            scope.popupOverlay.setPosition(undefined);
            closer.blur();
            return false;
        };
        this.popupOverlay &#x3D; new ol.Overlay({
            element: container,
            autoPan: true,
            autoPanMargin:20,
            positioning: &#x27;top-center&#x27;
        });

        this.capaDistrital &#x3D; {
            keyName: &#x27;capaDistrital&#x27;,
            name: &#x27;Capa Distrital&#x27;,
            active: false,
            description: &#x27;Capa de división distrital&#x27;,
            layer: undefined
        };
        this.capaCantonal &#x3D; {
            keyName: &#x27;capaCantonal&#x27;,
            name: &#x27;Capa Cantonal&#x27;,
            active: true,
            description: &#x27;Capa de división cantonal&#x27;,
            layer: undefined
        };
        this.capaProvincial &#x3D; {
            keyName: &#x27;capaProvincial&#x27;,
            name: &#x27;Capa Provincial&#x27;,
            active: true,
            description: &#x27;Capa de división provincial&#x27;,
            layer: undefined
        };
        this.capaDetalle &#x3D; {
            keyName: &#x27;capaDetalle&#x27;,
            name: &#x27;Capa de detalle&#x27;,
            active: false,
            description: &#x27;Capa de Mosaicos Topográficos&#x27;,
            layer: undefined
        };
        this.capaUrbana &#x3D; {
            keyName: &#x27;capaUrbana&#x27;,
            name: &#x27;Capa Urbana&#x27;,
            active: true,
            description: &#x27;Capa de detalle urbano&#x27;,
            layer: undefined
        };
        this.capaOSM &#x3D; {
            keyName: &#x27;capaOSM&#x27;,
            name: &#x27;Capa Urbana&#x27;,
            active: true,
            description: &#x27;Capa de detalle urbano&#x27;,
            layer: undefined
        };
        this.initLayer(this.capaDistrital);
        this.initLayer(this.capaCantonal);
        this.initLayer(this.capaProvincial);
        this.initLayer(this.capaDetalle);
        this.initLayer(this.capaUrbana);
        this.initLayer(this.capaOSM);

        this.layersGroupList &#x3D; [
            { keyName: &quot;grupoDetalle&quot;, name: &quot;Capa Detalle&quot;, active: this.capaDetalle.active, layers: [this.capaDetalle] },
            { keyName: &quot;grupoBase&quot;, name: &quot;Capa Base&quot;, active: true, layers: [this.capaOSM, this.capaUrbana] },
            { keyName: &quot;grupoDistrital&quot;, name: &quot;Capa Distrital&quot;, active: this.capaDistrital.active, layers: [this.capaDistrital] },
            { keyName: &quot;grupoCantonal&quot;, name: &quot;Capa Cantonal&quot;, active: this.capaCantonal.active, layers: [this.capaCantonal] },
            { keyName: &quot;grupoProvincial&quot;, name: &quot;Capa Provincial&quot;, active: this.capaProvincial.active, layers: [this.capaProvincial] }
        ];
        this.snitMapView &#x3D; new ol.View({
            projection: &#x27;EPSG:4326&#x27;,
            center: [this.currentLng, this.currentLat],
            zoom: this.currentZoom,
            minZoom: this.mapMinZoom
        });

        this.clearSnitMarkers();
    }

    initLayer(layer: snitMapLayer) {
        try {
            if (layer &amp;&amp; !layer.layer) {
                var source &#x3D; this.layerData[layer.keyName];
                if (layer.keyName &#x3D;&#x3D; &quot;capaOSM&quot;) {
                    layer.layer &#x3D; new ol.layer.Tile({
                        source: new ol.source.OSM()
                    }); return;
                }
                if (source) {
                    layer.layer &#x3D; new ol.layer.Tile({
                        source: new ol.source.TileWMS(source)
                    });
                }
                layer.layer.setVisible(layer.active);
            }
        } catch (ex) { console.log(&quot;error0---&gt;&quot; + ex) }
    }
    generateSnitMap() {
        var scope &#x3D; this;

        this.initSnitMapAssets()
        var layers &#x3D; [];
        try {
            this.layersGroupList.forEach(group &#x3D;&gt; {
                group.layers.forEach(layer &#x3D;&gt; {
                    if (layer.layer) {
                        layers.push(layer.layer)
                    }
                });
            });

        } catch (ex) { console.log(&quot;error1---&gt;&quot; + ex) }

        layers.push(this.vectorIcon);

        try {
            this.snitMap &#x3D; new ol.Map({
                controls: ol.control.defaults().extend([
                    new ol.control.ScaleLine({ units: &#x27;metric&#x27; })
                ]),
                target: &#x27;snitMap&#x27;,
                overlays: [this.popupOverlay],
                layers: layers,
                view: this.snitMapView

            });
        } catch (ex) { console.log(&quot;error2---&gt;&quot; + ex) }

        var genericMap: any &#x3D; this.snitMap;
        genericMap.on(&#x27;singleclick&#x27;, function (evt) {
            scope.snitSelectedElement &#x3D; undefined;
            var feature &#x3D; genericMap.forEachFeatureAtPixel(
                evt.pixel,
                function (ft, layer) { return ft; }
            );
            if (feature) {
                var element &#x3D; feature.get(&#x27;element&#x27;);
                try {
                    scope.snitSelectedElement &#x3D; element;
                    scope.openSnitElementPopUp(element)
                } catch (ex) { alert(ex); scope.popupOverlay.setPosition(undefined); }
            }
            else {
                scope.popupOverlay.setPosition(undefined);
            }
        });

        this.snitMapView.on(&#x27;change&#x27;, function (e) {
            var zoom: number &#x3D; scope.snitMapView.getZoom();
            var pos: [number, number] &#x3D; scope.snitMapView.getCenter();
            scope.currentLng &#x3D; pos[0];
            scope.currentLat &#x3D; pos[1];
            scope.currentZoom &#x3D; zoom;
        });

    }
    toggleLayerGroup(event, group: snitMapLayerGroup) {
        var active: boolean &#x3D; event.target.checked
        if (group) {
            group.active &#x3D; active;
            group.layers.forEach(layer &#x3D;&gt; {
                if (layer.layer) {
                    layer.active &#x3D; group.active;
                    layer.layer.setVisible(layer.active);
                }
            });
        }
    }

    fillSnitPopup(elm) {
        try {
            if (elm &amp;&amp; elm.type) {
                this.popupOverlay.setPosition([this.currentLng, this.currentLat]);//ol.proj.fromLonLat([elm.long, elm.lat]));
            }
            else {
                this.popupOverlay.setPosition(undefined);
            }
        } catch (ex) { alert(ex); this.popupOverlay.setPosition(undefined); }
    }

    centerMapOnMarker(element: any) {
        if (element) {
            this.currentLng &#x3D; element.long;
            this.currentLat &#x3D; element.lat;
        }
        this.updateSnitMapCenter();
    }

    updateSnitMapCenter() {
        if (this.snitMapView) {
            this.snitMapView.setCenter([this.currentLng, this.currentLat]),//ol.proj.fromLonLat([this.currentLng, this.currentLat]));
                this.snitMapView.setZoom(this.currentZoom);
        }
    }

    updateSnitMarkers() {
        this.clearSnitMarkers();
        this.addInfraSnitMarkers();
        this.addAsadaSnitMarkers();
    }

    clearSnitMarkers() {
        this.markerSource.clear();
        this.markerSource.refresh();
    }

    addInfraSnitMarkers() {
        this.infraestructuremarkers.forEach(element &#x3D;&gt; {
            if (element.visible) {
                var iconFeature &#x3D; this.createFeature(element.iconConfig.url, element.name, [element.long, element.lat], element);
                this.markerSource.addFeature(iconFeature);
            }
        });

    }

    addAsadaSnitMarkers() {
        this.asadasmarkers.forEach(element &#x3D;&gt; {
            if (element.visible) {
                var iconFeature &#x3D; this.createFeature(element.iconConfig.url, element.name, [element.long, element.lat], element);
                this.markerSource.addFeature(iconFeature);
            }
        });

    }

    createFeature(url: string, name: string, lngLatCoords: [number, number], element?: any): ol.Feature {
        var iconFeature &#x3D; new ol.Feature({
            geometry: new ol.geom.Point(lngLatCoords),//ol.proj.transform(lngLatCoords, &#x27;EPSG:4326&#x27;,
            //&#x27;EPSG:3857&#x27;)),
            name: name,

        });
        iconFeature.set(&#x27;url&#x27;, url);
        if (element) {
            iconFeature.set(&#x27;element&#x27;, element);
        }
        return iconFeature;
    }

    openSnitElementPopUp(element: any) {
        this.snitSelectedElement &#x3D; element;

        if (this.popupOverlay &amp;&amp; element &amp;&amp; element.type) {
            this.popupOverlay.setPosition([element.long, element.lat]);//ol.proj.fromLonLat([element.long, element.lat]));
        }
        else {
            this.popupOverlay.setPosition(undefined);
        }
    }

    showInfoWindow(asada: any) {
        asada.showInfoWindow &#x3D; true
        this.openSnitElementPopUp(asada);
        this.centerMapOnMarker(asada);
    }

    filterNotify(filConf: filterConfig) {
        this.filterConfiguration &#x3D; filConf;
        this.updateFiltersVisibilty();
        this.updateSnitMarkers();
    }

    updateFiltersVisibilty() {
        if (this.filterConfiguration) {
            var filtLoc: provincia[] &#x3D; this.filterConfiguration.locaciones.provincias;
            var filtCat: filterParam[] &#x3D; this.filterConfiguration.categorias;
            var filtRie: filterParam[] &#x3D; this.filterConfiguration.riesgos;

            for (let infra of this.infraestructuremarkers) {
                var showInfra &#x3D; true;
                if (showInfra &amp;&amp; filtRie) {
                    for (let param of filtRie) {
                        if((!infra.riskLevel &amp;&amp; (param.value.toLowerCase() &#x3D;&#x3D; &quot;noinfo&quot;)) ||
                            (infra.riskLevel &amp;&amp; (param.value.toLowerCase() &#x3D;&#x3D; infra.riskLevel.toLowerCase()))
                        ){
                            showInfra &#x3D; param.active;
                            break;
                        }
                    }
                }
                if (showInfra &amp;&amp; filtCat) {
                    filtCat.forEach(param &#x3D;&gt; {
                        if (param.value.toLowerCase() &#x3D;&#x3D; infra.type.toLowerCase()) {
                            showInfra &#x3D; showInfra &amp;&amp; param.active;
                        }
                    });
                }
                infra.visible &#x3D; showInfra;
            }
            for (let asada of this.asadasmarkers) {
                var showAsada &#x3D; true;
                if (showAsada &amp;&amp; filtLoc) {
                    filtLoc.forEach(prov &#x3D;&gt; {
                        if (prov.key &#x3D;&#x3D; asada.location.province.code) {
                            showAsada &#x3D; prov.active;
                            prov.cantones.forEach(cant &#x3D;&gt; {
                                if (cant.key &#x3D;&#x3D; asada.location.canton.code) {
                                    showAsada &#x3D; showAsada &amp;&amp; cant.active;
                                    cant.distritos.forEach(dist &#x3D;&gt; {
                                        if (dist.key &#x3D;&#x3D; asada.location.district.code) {
                                            showAsada &#x3D; showAsada &amp;&amp; dist.active;
                                        }
                                    });
                                }
                            });
                        }
                    });
                    this.getMarkersInfraestructurasAsada(asada).forEach(infra &#x3D;&gt; {
                        if (infra) {
                            infra.visible &#x3D; infra.visible &amp;&amp; showAsada;
                        }
                    });
                }
                if (showAsada &amp;&amp; filtCat) {
                    filtCat.forEach(param &#x3D;&gt; {
                        if (param.value.toLowerCase() &#x3D;&#x3D; &quot;asada&quot;) {
                            showAsada &#x3D; param.active;
                        }
                    });
                }
                asada.visible &#x3D; showAsada;
            }
        }
    }

    getMarkersInfraestructurasAsada(asada: asadastructure): genericInfraestructure[] {
        var infraAsada: genericInfraestructure[] &#x3D; [];
        this.infraestructuremarkers.forEach(param &#x3D;&gt; {
            if (param.asada.id &#x3D;&#x3D; asada.$key) {
                infraAsada.push(param);
            }
        });
        return infraAsada;
    }

    getResultAsadas(): void {
        this.mapService.getASADAS()
            .subscribe(results &#x3D;&gt; {
                this.AsadasList &#x3D; results;
                this.addASADASMarkers();
                this.updateSnitMarkers();
            }
            );
    }

    getResultAsadasTemp(): void {
        this.mapService.getASADAS()
            .subscribe(
                results &#x3D;&gt; {
                    this.AsadasListTemp &#x3D; results;
                    this.getInfraestructures();
                }
            );
    }

    getInfraestructures(): void {
        this.mapService.getInfrastructures()
            .subscribe(
                results &#x3D;&gt; {
                    this.allList &#x3D; results;
                    this.addInfraestructureMarker();
                    this.getResultAsadas();
                    this.updateSnitMarkers();
                    this.dataLoaded &#x3D; true;
                }
            );
    }
    

    setDetails(elem: asadastructure) {

        if (this.loadgraphic) {
            this.loadgraphic &#x3D; false;

        }
        else {
            this.loadgraphic &#x3D; true;
            this.AsadaId &#x3D; elem.$key;
        }
    }

    cancelModal() {
        this.loadgraphic &#x3D; false;
    }

    scrollTop() {
        var cosParameter &#x3D; window.scrollY / 2,
            scrollCount &#x3D; 0,
            oldTimestamp &#x3D; performance.now();
        function step(newTimestamp) {
            scrollCount +&#x3D; Math.PI / (500 / (newTimestamp - oldTimestamp));
            if (scrollCount &gt;&#x3D; Math.PI) window.scrollTo(0, 0);
            if (window.scrollY &#x3D;&#x3D;&#x3D; 0) return;
            window.scrollTo(0, Math.round(cosParameter + cosParameter * Math.cos(scrollCount)));
            oldTimestamp &#x3D; newTimestamp;
            window.requestAnimationFrame(step);
        }
        window.requestAnimationFrame(step);
    }

    redirectASADA(elem: asadastructure) {
        this.router.navigate([&quot;/asadaDetails/&quot; + elem.$key]);

    }

    redirectInfraestructure(elem: Infrastructure) {
        switch (elem.type.toLowerCase()) {
            case &quot;tanque&quot;: {
                this.router.navigate([&quot;/TanqueDetails//&quot; + elem.$key]);
                break;
            }
            case &quot;captacionnaciente&quot;: {
                this.router.navigate([&quot;/CaptacionNacienteDetails/&quot; + elem.$key]);
                break;
            }
            case &quot;captacionsuperficial&quot;: {
                this.router.navigate([&quot;/CaptacionSuperficialDetails/&quot; + elem.$key]);
                break;
            }
            case &quot;naciente&quot;: {
                this.router.navigate([&quot;/CaptacionSuperficialDetails/&quot; + elem.$key]);
                break;
            }
        }
    }

    addInfraestructureMarker() {

        for (let entry of this.allList) {

            var iconType &#x3D; &quot;&quot;;
            var isInfraestructure: boolean &#x3D; false;
            if (entry.type &#x3D;&#x3D; &quot;Tanque&quot;) {
                iconType &#x3D; &quot;Tanque&quot;
                isInfraestructure &#x3D; true;
            }
            else {
                if (entry.type &#x3D;&#x3D; &quot;CaptacionSuperficial&quot; || entry.type &#x3D;&#x3D; &quot;CaptacionNaciente&quot; || entry.type &#x3D;&#x3D; &quot;Naciente&quot;) {
                    iconType &#x3D; &quot;Naciente&quot;
                    isInfraestructure &#x3D; true;
                }
            }
            if (isInfraestructure) {
                var idasada &#x3D; entry.asada.id;

                var province;
                var phonenumber;
                for (let asadaElement of this.AsadasListTemp) {

                    if (asadaElement.$key &#x3D;&#x3D; idasada) {

                        province &#x3D; asadaElement.location.province.name;
                        phonenumber &#x3D; asadaElement.phoneNumber;

                        break;
                    }
                }
                var iconUrl;
                if (this.isLoggedIn) {

                    if (this.AsadaUser &#x3D;&#x3D; entry.asada.id || this.UserRol &#x3D;&#x3D; &quot;Super Administrador&quot;) {
                        switch (entry.riskLevel) {
                            case &quot;Nulo&quot;: {
                                iconUrl &#x3D; &quot;../../../assets/icons/&quot; + iconType + &quot;-nulo.png&quot;;
                                break;
                            }
                            case &quot;Bajo&quot;: {
                                iconUrl &#x3D; &quot;../../../assets/icons/&quot; + iconType + &quot;-bajo.png&quot;;
                                break;
                            }
                            case &quot;Intermedio&quot;: {
                                iconUrl &#x3D; &quot;../../../assets/icons/&quot; + iconType + &quot;-intermedio.png&quot;;
                                break;
                            }
                            case &quot;Alto&quot;: {
                                iconUrl &#x3D; &quot;../../../assets/icons/&quot; + iconType + &quot;-alto.png&quot;;
                                break;
                            }
                            case &quot;Muy Alto&quot;: {
                                iconUrl &#x3D; &quot;../../../assets/icons/&quot; + iconType + &quot;-muyalto.png&quot;;
                                break;
                            }
                            default: {
                                iconUrl &#x3D; &quot;../../../assets/icons/&quot; + iconType + &quot;.png&quot;;
                            }
                        }
                    }
                    else {
                        iconUrl &#x3D; &quot;../../../assets/icons/&quot; + iconType + &quot;-publico.png&quot;;
                    }
                }
                else {
                    iconUrl &#x3D; &quot;../../../assets/icons/&quot; + iconType + &quot;-publico.png&quot;;
                } 
                var infraestmarker &#x3D; {
                    $key: entry.$key,
                    name: entry.name,
                    lat: entry.lat,
                    long: entry.long,
                    iconConfig: {
                        url: iconUrl,
                        scaledSize: {
                            height: this.markerSize,
                            width: this.markerSize
                        },
                        anchor: { x: this.markerSize / 2, y: this.markerSize / 2 },
                    },
                    risk: entry.risk,
                    riskLevel: entry.riskLevel,
                    province: province,
                    phonenumber: phonenumber,
                    type: entry.type,
                    visible: true,
                    asada: {
                        id: entry.asada.id,
                        name: entry.asada.name
                    }
                }
                this.infraestructuremarkers.push(infraestmarker);
            }
        }
    }

    addASADASMarkers() {
        for (let asadaElement of this.AsadasList) {
            var iconUrl &#x3D; &quot;&quot;;
            if (this.isLoggedIn) {
                if (this.AsadaUser &#x3D;&#x3D; asadaElement.$key || this.UserRol &#x3D;&#x3D; &quot;Super Administrador&quot;) {
                    iconUrl &#x3D; &quot;../../../assets/icons/oficina.png&quot;;
                }
                else {
                    iconUrl &#x3D; &quot;../../../assets/icons/oficina.png&quot;;
                }
            }
            else {
                iconUrl &#x3D; &quot;../../../assets/icons/oficina.png&quot;;
            }
            var newAsadaMarker:asadastructure &#x3D; {
                $key: asadaElement.$key,
                name: asadaElement.name,
                lat: asadaElement.office.lat,
                long: asadaElement.office.long,
                iconConfig: {
                    url: iconUrl,
                    scaledSize: {
                        height: this.markerSize,
                        width: this.markerSize
                    },
                    anchor: { x: this.markerSize / 2, y: this.markerSize / 2 },
                },
                visible: true,
                
                location:asadaElement.location,
                population: asadaElement.population,
                phonenumber: asadaElement.phoneNumber,
                zonetype: asadaElement.zoneType,
                numbersubscribed: asadaElement.numberSubscribed,
                cantTanques: this.evalCantTanques(asadaElement.$key),
                cantSuperficial: this.evalCantCaptacion(asadaElement.$key),
                cantCloracion: this.evalCantSistemasClr(asadaElement.$key),
                showInfoWindow: false,
                zIndex: 100,
                type: &#x27;Asada&#x27;
            }
            
            this.asadasmarkers.push(newAsadaMarker);
        }
    }

    evalCantTanques(asadaid: string) {
        var list &#x3D; this.allList.filter(element &#x3D;&gt;
            (element.asada.id &#x3D;&#x3D; asadaid &amp;&amp; element.type &#x3D;&#x3D; &quot;Tanque&quot;));
        return list.length;
    }

    evalCantCaptacion(asadaid: string) {

        var list &#x3D; this.allList.filter(element &#x3D;&gt;
            (element.asada.id &#x3D;&#x3D; asadaid &amp;&amp; (element.type &#x3D;&#x3D; &quot;CaptacionNaciente&quot; || element.type &#x3D;&#x3D; &quot;CaptacionSuperficial&quot;)));
        return list.length;
    }

    evalCantSistemasClr(asadaid: string) {
        var list &#x3D; this.allList.filter(element &#x3D;&gt;
            (element.asada.id &#x3D;&#x3D; asadaid &amp;&amp; element.type &#x3D;&#x3D; &quot;SistemaCloracion&quot;));
        return list.length;
    }
}
interface snitMapLayerGroup {
    keyName: string,
    name: string,
    active: boolean,
    description?: string,
    layers: snitMapLayer[];
}
interface snitMapLayer {
    keyName: string,
    name: string,
    active: boolean,
    description?: string,
    layer: ol.layer.Tile;
}



interface genericInfraestructure {
    $key?: string;
    name: string;
    lat: number;
    long: number;
    iconConfig: {
        url: string,
        scaledSize: {
            height: number,
            width: number
        },
        anchor:{x:any,y:any}
    };
    visible: boolean;
    province: string;
    //asadaname: string;
    risk: number;
    riskLevel: string;
    phonenumber: string;
    type?: string;
    asada: {
        id: string;
        name: string;
    };
}


interface asadastructure {
    $key: string;
    name: string;
    lat: number;
    long: number;
    iconConfig: {
        url: string,
        scaledSize: {
            height: number,
            width: number
        },
        anchor:{x:any,y:any}
    };
    visible: boolean,
    location:{
        province: {code:number,name:string};
        canton:  {code:number,name:string};
        district:  {code:number,name:string};
        address: string;
    }
    population: number;
    phonenumber: string;
    //email: string;
    zonetype: string;
    numbersubscribed: number;
    cantTanques: number;
    cantSuperficial: number;
    cantCloracion: number;
    showInfoWindow: boolean;
    type: string;
    zIndex:number;
}

</code></pre>
    </div>
</div>






                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'genericInfraestructure.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <script src="../js/menu-wc.js"></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
